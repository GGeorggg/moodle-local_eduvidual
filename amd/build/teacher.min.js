define(["jquery","core/ajax","core/notification","core/str","core/templates","core/url","local_eduvidual/main","local_eduvidual/user"],function(b,c,d,e,f,g,h,i){return{courseAction:function(a,c){console.log("TEACHER.courseAction(courseid, selectmenu)",a,c);var d=b(c).val();b(c).val(""),require(["local_eduvidual/main"],function(b){switch(d){case"enrol":b.navigate(g.fileUrl("/local/eduvidual/pages/courses.php","")+"?act=enrol&id="+a);break;case"gradings":b.navigate(g.fileUrl("/grade/report/grader/index.php","")+"?id="+a);break;case"hideshow":b.connect({module:"teacher",act:"course_hideshow",courseid:a},{});break;case"remove":this.courseRemove(a)}})},courseRemove:function(a,b){if("undefined"!=typeof b&&b)require(["local_eduvidual/main"],function(b){b.connect({module:"teacher",act:"course_remove",courseid:a},{})});else{var c=this;e.get_strings([{key:"courseremove:title",component:"local_eduvidual"},{key:"courseremove:text",component:"local_eduvidual"},{key:"yes"},{key:"no"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){c.courseRemove(a,!0)})}).fail(d.exception)}},createCourseSelections:function(e){var f=this,g=+b("#"+e+"-orgid").val(),h=b("#"+e+"-subcat1").val(),i=b("#"+e+"-subcat2").val(),j=b("#"+e+"-subcat3").val(),k="local_eduvidual_teacher_createcourse_selections",l={orgid:g,subcat1:h,subcat2:i,subcat3:j};console.log("Sending to ",k,l),require(["local_eduvidual/main"],function(a){a.spinnerGrid(!0)}),c.call([{methodname:k,args:l,done:function(c){require(["local_eduvidual/main"],function(a){a.spinnerGrid(!1)});try{c=JSON.parse(c)}catch(d){}for(console.log("local_eduvidual_teacher_createcourse_selections",c),a=1;a<=4;a++)b("."+e+"-subcats"+a+"lbl").html(c["subcats"+a+"lbl"]);var g=[1,2,3,4],h={1:!0,2:!1,3:!1,4:!1},i={1:!1,2:!1,3:!1,4:!1};Object.keys(g).forEach(function(a){var d=g[a],f="subcat"+d,j="subcats"+d,k="subcats"+d+"lbl";if("undefined"!=typeof c[k]&&""==c[k])b("#"+e+"-form ."+e+"-"+k).html("").closest("tr").css("display","none"),i[d]=!0;else if(d<=2&&(h[d]=!0),3==d&&i[2]&&(h[d]=!0),4==d&&i[2]&&i[3]&&(h[d]=!0),b("#"+e+"-form ."+e+"-"+k).html(c[k]).closest("tr").css("display",""),"undefined"!=typeof c[j]){var l=b("#"+e+"-"+f),m=l.parent();if(c[j].length>0){if(l.is("select"))l.empty();else{l.remove();var l=b("<select>").attr("id",e+"-"+f).attr("name",f).attr("onchange","require(['local_eduvidual/teacher'], function(T) { T.createCourseSelections('"+e+"'); });").attr("style","width: 100%");m.append(l)}l.append(b("<option>").attr("value","").html("---")),Object.keys(c[j]).forEach(function(a){var d=b("<option>").attr("value",c[j][a]).html(c[j][a]);c[f]==c[j][a]&&d.attr("selected","selected"),l.append(d)})}else if(!l.is("input")){l.remove();var l=b("<input>").attr("id",e+"-"+f).attr("name",f).attr("onkeyup","require(['local_eduvidual/teacher'], function(T) { T.createCourseSelections('"+e+"'); });").attr("style","width: 100%").val(c[f]);m.append(l)}console.log(l)}});var j=!1;b("#"+e+"-form table.generaltable tr").each(function(a,c){"none"!=b(c).css("display")&&(j=!j,b(c).css("background-color",j?"rgba(0,0,0,0.05)":"#ffffff"))});var k=!0;Object.keys(h).forEach(function(a){b("#"+e+"-form ."+e+"-subcat"+a+" td.requirement").html(""),h[a]&&(console.log("Check ",a,b("#"+e+"-form #"+e+"-subcat"+a).val()),""==b("#"+e+"-form #"+e+"-subcat"+a).val()&&(k=!1),f.createCourseSelectionsRequired(b("#"+e+"-form ."+e+"-subcat"+a+" td.requirement")))}),k?b("#"+e+"-submit").removeClass("disabled"):b("#"+e+"-submit").addClass("disabled")},fail:d.exception}])},createCourseSelectionsRequired:function(a){f.render("local_eduvidual/teacher_createcourse_required",{}).then(function(c,d){b(a).html(""),f.appendNodeContents(b(a),c,d)}).fail(function(a){})},createModule:function(){var a=+b("#local_eduvidual_teacher_createmodule").attr("data-orgid"),c=+b("#local_eduvidual_teacher_createmodule").attr("data-courseid"),d=+b("#local_eduvidual_teacher_createmodule").attr("data-sectionid"),e=this.module.id,f={},g=this.module.payload.customize;if("undefined"!=typeof g)for(var h=Object.keys(g),i=0;i<h.length;i++){var j=h[i],k=(g[j],"edublock_custom_"+j);f[j]=b("#"+k).val()}f.course=c,f.section=d,require(["local_eduvidual/main"],function(b){b.connect({module:"teacher",act:"createmodule_create",orgid:a,moduleid:e,formdata:JSON.stringify(f)},{section:d})})},createModuleSearch:function(a){var c={};b("#"+a+"-createmoduleform").serializeArray().map(function(a){c[a.name]=a.value}),c.module="teacher",c.act="createmodule_search",console.log(c),require(["local_eduvidual/main"],function(b){b.connect(c,{uniqid:a,sectionid:c.sectionid,courseid:c.courseid})})},loadCategory:function(a){this.debug>0&&console.log("TEACHER.loadCategory(categoryid)",a);var c=b("#local_eduvidual_teacher_createmodule").attr("data-orgid");require(["local_eduvidual/main"],function(b){b.connect({module:"teacher",act:"createmodule_category",orgid:c,categoryid:a})})},loadCourseCategory:function(a,c){"undefined"==typeof c&&(c=+b("#local_eduvidual_teacher_createcourse").attr("data-orgid")),require(["local_eduvidual/main"],function(b){b.connect({module:"teacher",act:"createcourse_category",orgid:c,categoryid:a})})},loadCourseForm:function(a){console.log("TEACHER.loadCourseForm(step)",a),"undefined"==typeof a&&(a=0);var c=+b(".ul-eduvidual-courses").attr("data-categoryid"),f=+b(".ul-eduvidual-courses").attr("data-orgid");switch(f>0&&c>0&&0==a&&(a=1),a){case 0:break;case 1:var g=b(".ul-eduvidual-courses").empty(),h=b("<div>").addClass("grid-eq-2").css("text-align","center");g.append(h),e.get_strings([{key:"back",component:"local_eduvidual"},{key:"create",component:"local_eduvidual"},{key:"createcourse:basement",component:"local_eduvidual"},{key:"createcourse:name",component:"local_eduvidual"},{key:"createcourse:nameinfo",component:"local_eduvidual"},{key:"createcourse:setteacher",component:"local_eduvidual"},{key:"filter",component:"core"}]).done(function(a){var c=b("<div>"),d=b("<a>").addClass("ui-btn btn btn-_secondary").attr("onclick",'require(["local_eduvidual/user"], function(USER) { USER.loadCategory('+ +b(".ul-eduvidual-courses").attr("data-categoryid")+"); });").html(a[0]);d.html('<img src="/pix/t/left.svg" alt=""> '+d.html()),c.append(d);var e=b("<a>").addClass("btn ui-btn").attr("href","#").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCourseForm(2); });').html(a[1]);h.append([c,e]);var i=b("<div>").addClass("grid-eq-2");g.append(i);var j=b("<div>"),k=b('<div class="div-right">');i.append([j,k]);var l=b("<label>").html(a[2]),m=b('<select style="max-width: 100%;">').attr("onchange",'var sel = this; require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCourseFormBasementInfo(sel.value); });').addClass("local_eduvidual_teacher_createcourse_basement");m.append("<option>").html("loading");var n=b("<label>").html(a[3]),o=b("<p>").html(a[4]),p=b("<input>").addClass("local_eduvidual_teacher_createcourse_name");j.append([l,m,n,p,o]);var q=b("<div>").addClass("local_eduvidual_teacher_createcourse_setteacher").css("display","none"),r=b("<p>").html(a[5]),s=b("<input>").attr("placeholder",a[6]).attr("onkeyup",'var inp = this; require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCourseTeacher('+f+", inp); });"),t=b("<select>");q.append([r,s,t]),g.append(q),require(["local_eduvidual/main"],function(a){a.connect({module:"teacher",act:"createcourse_basements",orgid:f},{signalItem:m})})}).fail(d.exception);break;case 2:var i=+b(".local_eduvidual_teacher_createcourse_basement").val(),j=b(".local_eduvidual_teacher_createcourse_name").val(),k=+b(".local_eduvidual_teacher_createcourse_setteacher select").val();require(["local_eduvidual/main"],function(a){a.connect({module:"teacher",act:"createcourse_now",orgid:f,categoryid:c,basement:i,name:j,setteacher:k},{signalItem:{}})})}},loadCourseTeacher:function(a,c){var d=b(c).val();require(["local_eduvidual/main"],function(b){b.connect({module:"teacher",act:"createcourse_loadteacher",orgid:a,search:d},{signalItem:{}})})},loadCourseFormBasementInfo:function(a){for(var c=Object.keys(this.basements),d=b(".ul-eduvidual-courses .div-right").empty(),e=0;e<c.length;e++)for(var f=0;f<this.basements[c[e]].length;f++){var g=this.basements[c[e]][f];if(g.id==a&&0==b(d).find("img").length){var h=b("<p>").html(g.summary).css("text-align","justify");if(""!==g.imageurl){var i=b("<img>").attr("src",g.imageurl).css("max-width","200px").css("width","25%").css("margin","0px 0px 5px 5px").css("float","right");h.prepend(i)}d.append(h)}}},loadModuleForm:function(a){require(["local_eduvidual/main"],function(b){b.connect({module:"teacher",act:"createmodule_payload",moduleid:a})})},moolevels:function(a){var c=[];b.each(b("input[name='preferences_moolevels[]']:checked"),function(){c.push(b(this).val())}),require(["local_eduvidual/main"],function(d){d.connect({module:"teacher",act:"moolevels",moolevels:c},{signalItem:b(a).parent()})})},questioncategories:function(a){var c=[];b.each(b("input[name='questioncategories[]']:checked"),function(){c.push(+b(this).val())}),require(["local_eduvidual/main"],function(d){d.connect({module:"teacher",act:"questioncategories",questioncategories:c},{signalItem:b(a).parent()})})},result:function(a){var c=this;if("course_hideshow"==a.data.act&&("ok"==a.result.status?history.go(0):d.alert(a.result.error)),"course_remove"==a.data.act&&("ok"==a.result.status?history.go(-1):d.alert(a.result.error)),"createcourse_basements"==a.data.act){this.basements=a.result.basements;for(var f=Object.keys(a.result.basements),i=b(".local_eduvidual_teacher_createcourse_basement").empty(),j=!1,k=0;k<f.length;k++){for(var l=b("<optgroup>").attr("label",f[k]),m=0;m<a.result.basements[f[k]].length;m++){var n=a.result.basements[f[k]][m],o=b("<option>").attr("value",n.id).html(n.fullname);l.append(o),j||(j=!0,this.loadCourseFormBasementInfo(n.id))}i.append(l)}a.result.canmanage?b(".local_eduvidual_teacher_createcourse_setteacher").css("display","block"):b(".local_eduvidual_teacher_createcourse_setteacher").css("display","block")}if("createcourse_category"==a.data.act&&"ok"==a.result.status){var p="undefined"!=typeof a.result.parent&&a.result.parent.id>-1?a.result.parent.id:-1,q=b("#local_eduvidual_teacher_createcourse").empty();b("#local_eduvidual_teacher_createcourse_title").html(a.result.category.name),e.get_strings([{key:"back",component:"local_eduvidual"},{key:"createcourse:here",component:"local_eduvidual"}]).done(function(c){var d=b("<div>").addClass("form-inline felement").css("text-align","center").attr("data-fieldtype","group"),e=b("<div>").addClass("form-group fitem"),f=b("<div>").addClass("form-group fitem"),g=b("<a>").addClass("ui-btn btn btn-secondary").attr("onclick","history.go(-1);").html(c[0]);"undefined"!=typeof p&&p>0&&g.attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCourseCategory('+a.result.parent.id+"); });").html(a.result.parent.name),g.html('<img src="/pix/t/left.svg" alt=""> '+g.html());var h=b("<a>").addClass("ui-btn btn btn-primary").attr("href","#").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCourseForm('+a.result.category.id+"); });").html('<img src="/pix/t/add.svg" alt=""> '+c[1]);e.append(g),f.append(h),d.append([e,f]),q.append(d)}).fail(d.exception);var r=b("<ul>").attr("data-role","listview").attr("data-inset","true").attr("data-filter","true").addClass("ui-listview ui-listview-inset ui-corner-all ui-shadow");if("undefined"!=typeof a.result.children){var s=Object.keys(a.result.children);if("undefined"!=typeof a.result.children&&s.length>0)for(var k=0;k<s.length;k++){var t=a.result.children[s[k]],u=b("<li>").addClass("ui-li-has-count"+(k==s.length-1?" ui-last-child":"")),v=b("<a>").attr("href","#").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCourseCategory('+t.id+"); });"),w=b("<h3>").html(t.name),x=b("<p>").html(t.description);v.append([w,x]),u.append(v),r.append(u)}}q.append(r);try{b(r).trigger("create")}catch(y){}}if("createcourse_now"==a.data.act&&"ok"==a.result.status&&require(["local_eduvidual/user"],function(b){b.loadCategory(a.data.categoryid,a.data.orgid)}),"createcourse_loadteacher"==a.data.act&&"ok"==a.result.status)for(var z=b(".local_eduvidual_teacher_createcourse_setteacher select").empty(),A=0;A<a.result.users.length;A++){var B=a.result.users[A],o=b("<option>").attr("value",B.id).html(B.userfullname+"("+B.email+")");z.append(o)}if("createmodule_category"==a.data.act){var q=b("#local_eduvidual_teacher_createmodule").empty();e.get_strings([{key:"back",component:"local_eduvidual"}]).done(function(c){var d=b("<a>").addClass("ui-btn btn").attr("onclick","history.go(-1);").html(c[0]),e="undefined"!=typeof a.result.category&&a.result.category.parentid>-1?a.result.category.parentid:-1;if(console.log(e),"undefined"!=typeof e&&e>-1)var d=b("<a>").addClass("ui-btn btn").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCategory('+e+"); });").html(c[0]);q.append(d)}).fail(d.exception);var s=Object.keys(a.result.children);if("undefined"!=typeof a.result.children&&s.length>0){for(var r=b("<ul>").attr("data-role","listview").attr("data-inset","true").attr("data-filter","true").addClass("ui-listview ui-listview-inset ui-corner-all ui-shadow fix-images"),k=0;k<s.length;k++){var t=a.result.children[s[k]],u=b("<li>").addClass("ui-li-has-count ui-li-has-thumb ui-first-child"),v=b("<a>").addClass("ui-btn").attr("href","#").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCategory('+t.id+"); });"),w=b("<h3>").html(t.name),x=b("<p>").html(t.description),C=b("<img>").attr("src",t.imageurl).attr("alt",t.name);v.append([C,w,x]),u.append(v),r.append(u)}q.append(r);try{b(r).trigger("create")}catch(y){}}var s=Object.keys(a.result.modules);if("undefined"!=typeof a.result.modules&&s.length>0){for(var r=b("<ul>").attr("data-role","listview").attr("data-inset","true").attr("data-filter","true").addClass("ui-listview ui-listview-inset ui-corner-all ui-shadow fix-images"),k=0;k<s.length;k++){var t=a.result.modules[s[k]];""==t.imageurl&&(t.imageurl=a.result.category.imageurl),console.log(t.payload);var u=b("<li>").addClass("ui-li-has-count ui-li-has-thumb ui-first-child"),v=(JSON.parse(t.payload),b("<a>").addClass("ui-btn").attr("href","#").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadModuleForm('+t.id+"); });")),w=b("<h3>").html(t.name),x=b("<p>").html(t.description),C=b("<img>").attr("src",t.imageurl).attr("alt",t.name);v.append([C,w,x]),u.append(v),r.append(u)}q.append(r);try{b(r).trigger("create")}catch(y){}}q.trigger("create")}if("createmodule_create"==a.data.act)if("undefined"!=typeof a.result.modcourse){var D=g.fileUrl("/course/view.php","")+"?id="+a.result.modcourse+"&section="+a.payload.section;console.log("Redirecting to "+D);var E=null!==localStorage.getItem("local_eduvidual_isembedded")&&1==localStorage.getItem("local_eduvidual_isembedded"),F=0;E&&(F=1e3,require(["local_eduvidual/jquery-ba-postmessage"],function(b){b.post("open_course|"+a.result.modcourse)})),setTimeout(function(){h.navigate(D)},F)}else e.get_strings([{key:"createmodule:failed",component:"local_eduvidual"},{key:"ok"}]).done(function(a){d.alert("Error",a[0],a[1])}).fail(d.exception);if("createmodule_payload"==a.data.act&&("undefined"!=typeof a.result.module.payload?(a.result.module.payload=JSON.parse(a.result.module.payload),this.module=a.result.module,"undefined"!=typeof a.result.module.payload.customize?e.get_strings([{key:"back",component:"local_eduvidual"},{key:"createmodule:create",component:"local_eduvidual"}]).done(function(d){var e=b("#local_eduvidual_teacher_createmodule").empty(),f=b("<a>").addClass("ui-btn btn").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.loadCategory('+a.result.module.categoryid+"); });").html(d[0]);e.append(f),console.log(a.result.module.payload),c.listModuleForm(e,a.result.module);var f=b("<a>").addClass("ui-btn btn").attr("onclick",'require(["local_eduvidual/teacher"], function(TEACHER) { TEACHER.createModule(); });').html(d[1]);e.append(f)}).fail(d.exception):this.createModule()):e.get_strings([{key:"createmodule:invalid",component:"local_eduvidual"},{key:"ok"}]).done(function(a){d.alert("Error",a[0],a[1])}).fail(d.exception)),"createmodule_search"==a.data.act){var q=b("#local_eduvidual_teacher_createmodule_publisher").empty();if("undefined"!=typeof a.result.relevance){var G=Object.keys(a.result.relevance);G.sort(),G.reverse();for(var r=b("<ul>").attr("data-role","listview").attr("data-inset","true").attr("data-filter","true").addClass("ui-listview ui-listview-inset ui-corner-all ui-shadow"),k=0;k<G.length;k++)for(var H=G[k],I=Object.keys(a.result.relevance[H]),m=0;m<I.length;m++){console.log("Package-ID",a.result.relevance[H][m]);var J=a.result.packages[a.result.relevance[H][m]],u=b("<li>").addClass("ui-li-has-count ui-li-has-thumb ui-first-child"),v=b("<a>").addClass("ui-btn").attr("href",g.fileUrl("/blocks/edupublisher/pages/","import.php?package="+J.id+"&course="+a.payload.courseid+"&section="+a.payload.sectionid)),w=b("<h3>").html(J.title),x=b("<p>").html(J.default_summary),C=b("<img>").attr("src",J.default_imageurl).attr("alt",""),K=b("<a>").attr("href",g.fileUrl("/course","view.php?id="+a.payload.courseid)).attr("target","_blank").html('<img src="/pix/i/info.svg" />').css("top","40px").css("min-height","30px !important");c.resultRatingInject(J,w),v.append([C,w,x]),u.append([v,K]),r.append(u)}q.append(r);try{b(r).trigger("create")}catch(y){}}q.trigger("create")}if("user_search"==a.data.act){var L;if("local_eduvidual_courses_courseusers_search"==b(a.payload.sender).attr("id")&&(L="#local_eduvidual_courses_courseusers"),"local_eduvidual_courses_orgusers_search"==b(a.payload.sender).attr("id")&&(L="#local_eduvidual_courses_orgusers"),"undefined"==typeof L)console.log(a.payload),d.alert("Unknown type of search");else if(0!=a.result.users.length||a.payload.initialsearch){if(a.result.users.length>0){b(L).empty();for(var k=0;k<a.result.users.length;k++)b(L).append(b("<option>").attr("value",a.result.users[k].userid).html(a.result.users[k].name))}}else b(L).empty(),b(L).append(b("<option>").html("no results"))}"user_set"==a.data.act&&this.user_search("#local_eduvidual_courses_courseusers_search","courseusers",0)},resultRatingInject:function(a,c){require(["core/templates","core/notification"],function(d,e){d.render("block_edupublisher/package_rating_display",a).then(function(a,d){console.log(a,d);var e=b('<div style="float: right;"></div>');e.append(a),b(c).prepend(e),b("body").append(d)}).fail(e.exception)})},listModuleForm:function(a,c){console.log("TEACHER.listModuleForm(pane, mod)",a,c);for(var f=c.payload.customize,g=Object.keys(f),h=0;h<g.length;h++){var i=g[h],j=f[i],k="edublock_custom_"+i,l="undefined"!=typeof j["default"]?j["default"]:"",m="undefined"!=typeof j.label?j.label:i;if(j.required&&(m+='<sup style="color: red;">*)</sup>'),"label"==j.type){var n=b("<p>").html(j.name);"undefined"!=typeof j.style&&n.addClass(j.style),a.append([n])}else if("memo"==j.type){var n=b("<label>").attr("for",k).html(m),o=b("<textarea>").attr("id",k).html(l).attr("rows","10").addClass("ui-input-text ui-shadow-inset ui-body-inherit ui-corner-all ui-textinput-autogrow");a.append([n,o])}else if("url"==j.type){var n=b("<label>").attr("for",k).html(m),o=b("<input>").attr("id",k).attr("type","url").val(l).css("width","100%").addClass("ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset");a.append([n,o])}else if("checkbox"==j.type){var n=b("<label>").attr("for",k).html(m),o=b("<select>").attr("id",k).attr("data-role","slider").val(l);o.append(b("<option>").attr("value","0").html("Nein")),o.append(b("<option>").attr("value","1").html("Ja")),a.append([o,n])}else if("select"==j.type){var n=b("<label>").attr("for",k).html(m),o=b("<select>").attr("id",k);if("undefined"!=typeof j.options)for(var p=Object.keys(j.options),q=0;q<p.length;q++){var r=p[q],s=b("<option>").html(j.options[r].name);"undefined"!=typeof j.options[r].value&&s.attr("value",j.options[r].value),o.append(s)}o.val(l),a.append([n,o])}else if("range"==j.type){var n=b("<label>").attr("for",k).html(m),o=b('<input type="number" value="0" min="0" max="100" step="1" data-highlight="true">').attr("id",k).val(l);"undefined"!=typeof j.min&&o.attr("min",j.min),"undefined"!=typeof j.max&&o.attr("max",j.max),"undefined"!=typeof j.step&&o.attr("step",j.step),a.append([n,o])}else{var n=b("<label>").attr("for",k).html(m),o=b("<input>").attr("id",k).attr("type","text").val(l).css("width","100%").addClass("ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset");a.append([n,o])}}e.get_strings([{key:"createmodule:requiredfield",component:"local_eduvidual"}]).done(function(c){a.append(b('<br /><p><sup style="color: red;">*)</sup> '+c[0]+"</p>"))}).fail(d.exception),a.trigger("create")},user_search:function(a,c,d){var e=+b("#local_eduvidual_courses").attr("data-orgid"),f=+b("#local_eduvidual_courses").attr("data-courseid"),g=b(a).val();require(["local_eduvidual/main"],function(b){b.connect({module:"teacher",act:"user_search",orgid:e,courseid:f,type:c,searchfor:g},{sender:a,initialsearch:d})})},user_set:function(a,c){var d,e,f=[];if("enrol"==c?(d=b("#local_eduvidual_courses_orgusers"),e=b("#local_eduvidual_courses_setrole").val()):"unenrol"==c&&(d=b("#local_eduvidual_courses_courseusers"),e="remove"),"undefined"!=typeof d){var g=+b("#local_eduvidual_courses").attr("data-orgid"),h=+b("#local_eduvidual_courses").attr("data-courseid"),f=[];b(d).find('option:selected:not([value=""])').each(function(){f.push(+b(this).val())}),require(["local_eduvidual/main"],function(c){c.connect({module:"teacher",act:"user_set",orgid:g,courseid:h,role:e,userids:f},{signalItem:b(a)})})}}}});