define(["jquery","core/ajax","core/notification","core/str","core/url","local_eduvidual/admin","local_eduvidual/manager","local_eduvidual/teacher","local_eduvidual/user","local_eduvidual/register","local_eduvidual/preferences","core/modal_factory","core/modal_events"],function(e,j,f,c,i,g,l,h,d,b,a,k,m){return{requestId:0,debug:3,confirmed:function(n,q,p){var o="local_eduvidual_"+((q)?"stored":"failed");if(typeof p==="undefined"||p==0){p=1000}console.log("MAIN.confirmed(selector, success, timeout)",n,q,p);e(n).addClass(o);setTimeout(function(){e(n).removeClass(o)},p)},connect:function(p,q){if(this.debug>0){console.log("MAIN.connect(data, payload)",p,q)}var r={data:p,payload:q,requestId:this.requestId++};var n=this;n.signal(r.payload,true);n.spinnerGrid(true);e.ajax({url:i.fileUrl("/local/eduvidual/ajax/ajax.php",""),method:"POST",data:p,}).done(function(o){try{o=JSON.parse(o)}catch(s){}r.result=o;if(typeof r.result!=="undefined"&&typeof r.result.status!=="undefined"){n.signal(r.payload,false,(r.result.status=="ok"))}if(n.debug>2){console.log("< RequestId #"+r.requestId,r)}n.result(r)}).fail(function(o,s){n.signal(r.payload,false,false);r.textStatus=s;if(n.debug>2){console.error("* RequestId #"+r.requestId,r)}}).always(function(){n.spinnerGrid(false)})},doLogout:function(){var n=localStorage.getItem("local_eduvidual_originallocation");if(n==null){n=""}top.location.href=i.fileUrl("/local/eduvidual/pages/login_app.php","")+"?dologout=1&originallocation="+encodeURI(n)},navigate:function(n){if(n.indexOf("#")==0){return}var o=this;require(["local_eduvidual/user"],function(p){p.toggleSubmenu(false)});o.spinnerGrid(true);console.log("Normal navigate to ",n);location.href=n;return false},result:function(p){if(typeof p.result.error!=="undefined"&&p.result.error!=""){console.log(p.result.error);c.get_strings([{key:"confirm",component:"core"},{key:p.result.error,component:"local_eduvidual"},]).done(function(o){f.alert(o[1],o[0])}).fail(f.exception)}var n=p.data.module;if(n=="manage"){n="manager"}require(["local_eduvidual/"+n],function(o){o.result(p)})},popPage:function(o,p){if(typeof p==="undefined"){p="?"}var n=i.fileUrl("/local/eduvidual/pages/"+o+".php",p);console.log("popPage ",n);e.get(n).done(function(q){console.log("Got body ",q);k.create({title:"",body:q,}).done(function(r){console.log("Created modal");r.show()})}).fail(function(q){console.err("Error",q)})},signal:function(n,p,o){console.log("MAIN.signal(payload, to, success)",n,p,o);if(typeof n!=="undefined"&&typeof n.signalItem!=="undefined"){if(typeof p!=="undefined"&&p){e(n.signalItem).addClass("local_eduvidual_signal")}else{e(n.signalItem).removeClass("local_eduvidual_signal")}if(typeof o!=="undefined"){e(n.signalItem).addClass("local_eduvidual_signal_"+((o)?"success":"error"));setTimeout(function(){e(n.signalItem).removeClass("local_eduvidual_signal_"+((o)?"success":"error"))},1000)}}},spinnerGrid:function(n){if(typeof e(".spinner-grid")==="undefined"||e(".spinner-grid")==null||e(".spinner-grid").length==0){e("body").prepend(e('<div class="spinner-grid"><div /><div /><div /><div /></div>'))}if(typeof n!=="undefined"&&(n=="show"||n==true)){e(".spinner-grid").addClass("show")}else{e(".spinner-grid").removeClass("show")}},toggle:function(p,n,o){if(this.debug>5){console.log("local_eduvidual/main:toggle(uniqid, a, target)",p,n,o)}e("."+p+"-card").addClass("hidden");e(n).closest(".toggle-controller-"+p).find("a").removeClass("active");e("#"+p+"-"+o).removeClass("hidden");e(n).addClass("active")},watchValue:function(p){if(this.debug>5){console.log("MAIN.watchValue(o)",p)}var n=this;if(e(p.target).attr("data-iswatched")!="1"){e(p.target).attr("data-iswatched",1);p.interval=setInterval(function(){if(e(p.target).val()==p.compareto){p.run();clearInterval(p.interval);e(p.target).attr("data-iswatched",0)}else{p.compareto=e(p.target).val()}},1000)}},}});