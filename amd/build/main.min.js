define(["jquery","core/ajax","core/notification","core/str","core/url","block_eduvidual/admin","block_eduvidual/manager","block_eduvidual/teacher","block_eduvidual/user","block_eduvidual/register","block_eduvidual/preferences","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){return{requestId:0,debug:3,confirmed:function(b,c,d){var e="block_eduvidual_"+(c?"stored":"failed");"undefined"!=typeof d&&0!=d||(d=1e3),console.log("MAIN.confirmed(selector, success, timeout)",b,c,d),a(b).addClass(e),setTimeout(function(){a(b).removeClass(e)},d)},connect:function(b,c){this.debug>0&&console.log("MAIN.connect(data, payload)",b,c);var d={data:b,payload:c,requestId:this.requestId++},f=this;f.signal(d.payload,!0),f.spinnerGrid(!0),a.ajax({url:e.fileUrl("/blocks/eduvidual/ajax/ajax.php",""),method:"POST",data:b}).done(function(a){try{a=JSON.parse(a)}catch(b){}d.result=a,"undefined"!=typeof d.result&&"undefined"!=typeof d.result.status&&f.signal(d.payload,!1,"ok"==d.result.status),f.debug>2&&console.log("< RequestId #"+d.requestId,d),f.result(d)}).fail(function(a,b){f.signal(d.payload,!1,!1),d.textStatus=b,f.debug>2&&console.error("* RequestId #"+d.requestId,d)}).always(function(){f.spinnerGrid(!1)})},doLogout:function(){var a=localStorage.getItem("block_eduvidual_originallocation");null==a&&(a=""),top.location.href=e.fileUrl("/blocks/eduvidual/pages/login_app.php","")+"?dologout=1&originallocation="+encodeURI(a)},navigate:function(a){if(0!=a.indexOf("#")){var b=this;return require(["block_eduvidual/user"],function(a){a.toggleSubmenu(!1)}),b.spinnerGrid(!0),console.log("Normal navigate to ",a),location.href=a,!1}},result:function(a){"undefined"!=typeof a.result.error&&""!=a.result.error&&(console.log(a.result.error),d.get_strings([{key:"confirm",component:"core"},{key:a.result.error,component:"block_eduvidual"}]).done(function(a){c.alert(a[1],a[0])}).fail(c.exception));var b=a.data.module;"manage"==b&&(b="manager"),require(["block_eduvidual/"+b],function(b){b.result(a)})},popPage:function(b,c){"undefined"==typeof c&&(c="?");var d=e.fileUrl("/blocks/eduvidual/pages/"+b+".php",c);console.log("popPage ",d),a.get(d).done(function(a){console.log("Got body ",a),l.create({title:"",body:a}).done(function(a){console.log("Created modal"),a.show()})}).fail(function(a){console.err("Error",a)})},signal:function(b,c,d){console.log("MAIN.signal(payload, to, success)",b,c,d),"undefined"!=typeof b&&"undefined"!=typeof b.signalItem&&("undefined"!=typeof c&&c?a(b.signalItem).addClass("block_eduvidual_signal"):a(b.signalItem).removeClass("block_eduvidual_signal"),"undefined"!=typeof d&&(a(b.signalItem).addClass("block_eduvidual_signal_"+(d?"success":"error")),setTimeout(function(){a(b.signalItem).removeClass("block_eduvidual_signal_"+(d?"success":"error"))},1e3)))},spinnerGrid:function(b){"undefined"!=typeof a(".spinner-grid")&&null!=a(".spinner-grid")&&0!=a(".spinner-grid").length||a("body").prepend(a('<div class="spinner-grid"><div /><div /><div /><div /></div>')),"undefined"==typeof b||"show"!=b&&1!=b?a(".spinner-grid").removeClass("show"):a(".spinner-grid").addClass("show")},watchValue:function(b){this.debug>5&&console.log("MAIN.watchValue(o)",b);"1"!=a(b.target).attr("data-iswatched")&&(a(b.target).attr("data-iswatched",1),b.interval=setInterval(function(){a(b.target).val()==b.compareto?(b.run(),clearInterval(b.interval),a(b.target).attr("data-iswatched",0)):b.compareto=a(b.target).val()},1e3))}}});