define(["jquery","core/ajax","core/notification","core/str","core/url","local_eduvidual/main"],function(f,b,c,e,a,d){return{debug:false,dashboardEnhanceInfo:{},run:function(g){console.log("local_eduvidual/jsinjector:run(data)",g);e.get_strings([{key:"Accesscard",component:"local_eduvidual"}]).then(function(h){f('.usermenu .dropdown a[href$="/user/preferences.php"]').after(f("<a>").attr("href",a.relativeUrl("local/eduvidual/pages/accesscard.php")).addClass("dropdown-item menu-action").attr("role","menuitem").attr("data-title","moodle,accesscard").attr("aria-labelledby","actionmenuaction-accesscard").attr("data-ajax","false").append([f("<i>").addClass("icon fa fa-id-card fa-fw").attr("aria-hidden","true"),f("<span>").addClass("menu-action-text").attr("id","actionmenuaction-accesscard").html(h[0]),]))});f("a[href*='/login/logout.php?sesskey']").attr("href",a.relativeUrl("/local/eduvidual/pages/redirects/logout.php"));this.fakeBreadCrumb()},clearSessionStorage:function(){console.log("local_eduvidual/jsinjector:clearSessionStorage()");sessionStorage.clear()},courseEditPage:function(g){f("#fitem_id_shortname").css("display","none");if(f("#fitem_id_shortname #id_shortname").val()==""){var h=new Date();f("#fitem_id_shortname #id_shortname").val(g+"-"+Date.now())}},dashboardCourseLoaded:function(){console.log("local_eduvidual/jsinjector:dashboardCourseLoaded()");var g=this;f(".dashboard-card-deck>.dashboard-card:not(.local-eduvidual-enhanced)").each(function(){g.dashboardEnhanceCourse(f(this))})},dashboardEnhanceCourse:function(g){g.addClass("local-eduvidual-enhanced local-eduvidual-transition-all");var h=this;var i=+f(g).attr("data-course-id");var k=f(g).find(".dashboard-card-footer");if(i>0){if(typeof this.dashboardEnhanceInfo[i]!=="undefined"){var j=this.dashboardEnhanceInfo[i];g.attr("id","dashboard-card-"+i);k.empty().append(f("<a>").html(j.label).attr("href","#").attr("onclick","$('#dashboard-card-"+i+">*').toggleClass('local-eduvidual-height-no'); return false;"));g.append(f("<div>").addClass("local-eduvidual-height-no").append([f("<a>").html("hide").attr("href","#").attr("onclick","$('#dashboard-card-"+i+">*').toggleClass('local-eduvidual-height-no'); return false;")]))}else{k.empty();b.call([{methodname:"local_eduvidual_user_course_news",args:{courseid:i},done:function(l){console.log("got reply for courseid "+i,l);if(typeof l.label!=="undefined"&&l.label!=""){h.dashboardEnhanceInfo[i]=l;h.dashboardEnhanceCourse(g)}},fail:c.exception}])}}else{console.error("Courseid is empty",i)}},fakeBreadCrumb:function(){if(f("#page #page-header .card-body .d-flex.flex-wrap #page-navbar").length==0){e.get_strings([{key:"navigation",component:"core"},{key:"myhome",component:"core"}]).then(function(g){f("#page #page-header .card-body .d-flex.flex-wrap").prepend(f('<div id="page-navbar">').append(f('<nav role="navigation" aria-label="'+g[0]+'">').append(f('<ol class="breadcrumb">').append(f('<li class="breadcrumb-item">').append(f('<a data-ajax="false">').attr("href",a.relativeUrl("/my")).html(g[1]))))))})}},modifyRedirectUrl:function(g){if(this.debug){console.log("local_eduvidual/jsinjector:modifyRedirectUrl(type)",g)}if(g=="coursedelete"){f("#page-content .continuebutton form").attr("action",a.relativeUrl("/my"));f('#page-content .continuebutton form input[name="categoryid"]').remove()}},orgMenu:function(g){console.log("local_eduvidual/jsinjector:orgMenu(userid)",g);if(typeof g=="undefined"||g==0){return}var h=sessionStorage.getItem("local_eduvidual_foruserid");var i=sessionStorage.getItem("local_eduvidual_orgmenu");if(g!=h){i=false}if(typeof i==="undefined"||!i){b.call([{methodname:"local_eduvidual_user_orgmenu",args:{userid:g},done:function(j){sessionStorage.setItem("local_eduvidual_foruserid",g);sessionStorage.setItem("local_eduvidual_orgmenu",j);f(j).insertBefore(f("#page-wrapper>.navbar div.usermenu").closest("li"))},fail:c.exception}])}else{f(i).insertBefore(f("#page-wrapper>.navbar div.usermenu").closest("li"))}},signupPage:function(){e.get_strings([{key:"email",component:"core"}]).then(function(g){f('#fitem_id_username label[for="id_username"]').html(g[0]);f("#fitem_id_username #id_username").attr("onkeyup","document.getElementById('id_email').value = document.getElementById('id_username').value;");f("#fitem_id_email").css("display","none");f('form[action*="/login/signup.php"]').attr("onsubmit","document.getElementById('id_email').value = document.getElementById('id_username').value;")})},}});