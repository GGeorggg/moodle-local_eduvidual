define(["jquery","core/ajax","core/notification","core/str","core/url","block_eduvidual/main"],function(a,b,c,d,e,f){return{debug:1,debug_gps:1,cache_orgs:{},refresh_identifier:0,varcache:void 0,allmanagerscourses:function(){this.debug>0&&console.log("ADMIN.allmanagerscourses()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_allmanagerscourses",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"allmanagerscourses",allmanagerscourses:a(b.target).val()},{signalItem:a(b.target)})})}})})},blockfooter:function(b){this.debug>0&&console.log("ADMIN.blockfooter()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_blockfooter",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"blockfooter",blockfooter:a(b.target).val()},{signalItem:a(b.target)})})}})})},navbar:function(){this.debug>0&&console.log("ADMIN.navbar()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_navbar",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"navbar",navbar:a(b.target).val()},{signalItem:a(b.target)})})}})})},coursebasements:function(){this.debug>0&&console.log("ADMIN.coursebasements()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_coursebasements",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"coursebasements",coursebasements:a(b.target).val()},{signalItem:a(b.target)})})}})})},defaultrole:function(b,c){this.debug>0&&console.log("ADMIN.defaultrole(type, role)",b,c),require(["block_eduvidual/main"],function(d){d.connect({module:"admin",act:"defaultrole",type:b,role:c},{signalItem:a("#block_eduvidual_admin_defaultrole"+b)})})},dropZonePath:function(){this.debug>0&&console.log("ADMIN.dropZonePath()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_dropzonepath",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"dropzonepath",dropzonepath:a(b.target).val()},{signalItem:a(b.target)})})}})})},ltiresourcekey:function(){this.debug>0&&console.log("ADMIN.ltiresourcekey()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_ltiresourcekey",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"ltiresourcekey",ltiresourcekey:a(b.target).val()},{signalItem:a(b.target)})})}})})},manageorgs_open:function(b,c){var d=a("#"+b+"-form");a(d).find(".block_eduvidual_signal_error").removeClass("block_eduvidual_signal_error");var e=this.cache_orgs[c];if("undefined"!=typeof e)for(var f=Object.keys(e),g=0;g<f.length;g++){var h=f[g];a("#"+b+"-field-"+h).attr("data-orig",e[h]).val(e[h])}else d.find("input").val("").attr("data-orig","");"undefined"!=typeof e&&"undefined"!=typeof e.categoryid&&e.categoryid>0?(a("#"+b+"-field-orgid").attr("readonly","readonly"),a("#"+b+"-field-categoryid").css("display","block")):(a("#"+b+"-field-orgid").removeAttr("readonly"),a("#"+b+"-field-categoryid").css("display","none"))},manageorgs_reset:function(a){this.manageorgs_open(a,0)},manageorgs_search:function(b){require(["block_eduvidual/main"],function(c){c.watchValue({target:"#"+b+"-search",run:function(){var c=this;require(["block_eduvidual/main"],function(d){d.connect({module:"admin",act:"manageorgs_search",search:a(c.target).val()},{signalItem:a(c.target),uniqid:b})})}})})},manageorgs_store:function(b){var c=a("#"+b+"-form");a(c).find(".block_eduvidual_signal_error").removeClass("block_eduvidual_signal_error");var d={};c.find("input").each(function(){if("undefined"!=typeof a(this).attr("id")&&""!=a(this).attr("id")){var c=a(this).attr("id").replace(b+"-field-","");d[c]=a(this).val()}}),require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"manageorgs_store",fields:d},{signalItem:a("#"+b+"-store"),uniqid:b})})},orgrole:function(b,c){this.debug>0&&console.log("ADMIN.orgrole(type, role)",b,c),require(["block_eduvidual/main"],function(d){d.connect({module:"admin",act:"orgrole",type:b,role:c},{signalItem:a("#block_eduvidual_admin_orgrole"+b)})})},modifylogin:function(b){this.debug>0&&console.log("ADMIN.modifylogin(setto)",b),require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"modifylogin",setto:b},{signalItem:a("#block_eduvidual_admin_modifylogin")})})},moduleCatForm:function(a){require(["block_eduvidual/main"],function(b){b.connect({module:"admin",act:"modulecatform",categoryid:a})})},moolevels:function(b){this.debug>0&&console.log("ADMIN.moolevels()");var c=new Array;a.each(a("input[name='moolevels[]']:checked"),function(){c.push(a(this).val())}),require(["block_eduvidual/main"],function(d){d.connect({module:"admin",act:"moolevels",moolevels:c},{signalItem:a(b).parent()})})},org_gps:function(d,g,h,i,j){var k=this;k.refresh_identifier++;var l=k.refresh_identifier;"undefined"==typeof d&&(d=a(".block_eduvidual_admin_map").attr("id")),"undefined"==typeof g&&(g=-200),"undefined"==typeof h&&(h=200),"undefined"==typeof i&&(i=-200),"undefined"==typeof j&&(j=200),console.log("ADMIN.org_gps(uniqid, lon1, lon2, lat1, lat2)",d,g,h,i,j);var m=a("#"+d+"-include-nonegroup").prop("checked")?1:0,n="block_eduvidual_admin_org_gps",o={lon1:g,lon2:h,lat1:i,lat2:j,includenonegroup:m,advanceddata:0};"undefined"!=typeof k.map&&k.map.remove(),a("#"+d+"-legend td.none").parent().css("display",m?"table-row":"none"),k.debug_gps&&console.log("Sending to "+n,o),f.spinnerGrid(!0),b.call([{methodname:n,args:o,done:function(b){if(k.refresh_identifier==l){try{b=JSON.parse(b)}catch(c){}k.debug_gps&&console.log("Got response",b),f.spinnerGrid(!1);var g=b,h=200,i=200,j=-200,m=-200,n={both:0,eduv:0,lpf:0,none:0},o=[L.layerGroup(),L.layerGroup(),L.layerGroup(),L.layerGroup()],p={0:"",1:"Burgenland",2:"Kärnten",3:"Niederösterreich",4:"Oberösterreich",5:"Salzburg",6:"Steiermark",7:"Tirol",8:"Vorarlberg",9:"Wien"},q={0:"Sonstige",1:"VS",2:"MS",3:"Sonderschule",4:"PTS",5:"BS",6:"Gymnasium",7:"HTL",8:"HAK",9:"HUM"};Object.keys(g).forEach(function(a){if(k.refresh_identifier==l){g[a].url=e.relativeUrl("/blocks/eduvidual/pages/categories.php?orgid="+g[a].orgid);var b=g[a].orgid.toString().split("").pop(),c=g[a].orgid.toString().split("")[0];g[a].classes=q[b]+" "+p[c];var d="red";1==g[a].authenticated&&null!=g[a].lpf?(d="orange",n.both++,g[a].classes+=" both",g[a].layer=2,g[a].url=e.relativeUrl("/blocks/eduvidual/pages/categories.php?orgid="+g[a].orgid)):1==g[a].authenticated?(d="green",n.eduv++,g[a].classes+=" eduv",g[a].layer=3,g[a].url=e.relativeUrl("/blocks/eduvidual/pages/categories.php?orgid="+g[a].orgid)):null!=g[a].lpf?(d="blue",n.lpf++,g[a].classes+=" lpf",g[a].layer=1,g[a].url="https://www3.lernplattform.schule.at/"+g[a].lpf):(d="lightgray",n.none++,g[a].classes+=" none invisible",g[a].layer=0,g[a].url=""),"lightgray"!=d&&(g[a].lon<i&&(i=g[a].lon),g[a].lon>m&&(m=g[a].lon),g[a].lat<h&&(h=g[a].lat),g[a].lat>j&&(j=g[a].lat)),g[a].marker=e.relativeUrl("/blocks/eduvidual/pix/google-maps-pin-"+d+".svg#"+g[a].classes+"#"+g[a].layer)}});var r=[[h,i],[j,m]],s=(h+j)/2,t=(i+m)/2,u=[s,t];k.debug_gps&&console.log("Bounds",r),k.debug_gps&&console.log("Center",u);var v=a("#"+d+"-map").width();k.debug_gps&&console.log("Width",v),k.debug_gps&&console.log("Height",v/4*3),a("#"+d+"-map").css("height",v/4*3+"px");var w=L.icon({iconUrl:e.relativeUrl("/blocks/eduvidual/pix/google-maps-pin-blue.svg"),iconRetinaUrl:e.relativeUrl("/blocks/eduvidual/pix/google-maps-pin-blue.svg"),iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]});Object.keys(g).forEach(function(a){if(k.refresh_identifier==l){var b=w;"undefined"!=typeof g[a].marker&&""!=g[a].marker&&(b=L.icon({iconUrl:g[a].marker,iconRetinaUrl:g[a].marker,iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]}));var c=L.marker([g[a].lat,g[a].lon],{icon:b}).bindPopup("undefined"!=typeof g[a].url&&""!=g[a].url?'<a href="'+g[a].url+'" target="_blank">'+g[a].name+" ("+a+")</a>":g[a].name);c.addTo(o[g[a].layer])}});var x=new Date,y=[x.getFullYear(),String(x.getMonth()+1).padStart(2,"0"),String(x.getDate()).padStart(2,"0")].join("-"),z=1/9*6,A="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",B="Visualisierung der Moodle-Schulen in Österreich | "+y+' | <a href="https://www.lernmanagement.at" target="_blank">Zentrum für Lernmanagement</a> | powered by &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>';k.map=L.map(d+"-map",{boxZoom:!0,center:u,layers:o,zoom:14,zoomControl:!1,zoomSnap:.5}),k.map.fitBounds(r,{maxZoom:18}),k.map.on("moveend",function(a){k.org_gps_bounds(d)}),k.map.on("resize",function(b){k.debug_gps&&console.log("Map was resized",b);var c=a("#"+d+"-map").width();k.debug_gps&&console.log("Width",c),k.debug_gps&&console.log("Height",c*z),a("#"+d+"-map").css("height",c*z+"px")});var C={normal:L.tileLayer(A,{attribution:B,id:"mapbox.normal",subdomains:["a","b","c"]})};C.normal.addTo(k.map),L.control.zoom({position:"bottomright"}).addTo(k.map),a("#"+d+" .leaflet-marker-pane img").each(function(b,c){if(k.refresh_identifier==l){var d=a(c).attr("src"),e=d.split("#");3==e.length&&(a(c).addClass(e[1].replace(","," ")),a(c).css("z-index",990+e[2]))}}),a("#"+d+"-map").css("height",a("#"+d+"-map").width()*z+"px"),k.org_gps_bounds(d),k.org_gps_refresh(d)}},fail:c.exception}])},org_gps_bounds:function(b){var c=this;if("undefined"!=typeof c.map){var d=c.map.getBounds().toBBoxString().split(",");if(c.debug_gps&&console.log("Setting bounds to",d),a("#"+b).attr("data-lon1",d[0]),a("#"+b).attr("data-lon2",d[2]),a("#"+b).attr("data-lat1",d[1]),a("#"+b).attr("data-lat2",d[3]),"undefined"==typeof c.map_moved)c.map_moved=0;else{c.map_moved++;var e=c.map_moved;setTimeout(function(){e==c.map_moved&&c.org_gps_refresh(b)},1e3)}}},org_gps_refresh:function(b){var c=this;c.refresh_identifier++;var d=c.refresh_identifier;console.log("ADMIN.org_gps_refresh(uniqid)",b);var e=a("#"+b+"-map");a("#"+b+"-map .leaflet-marker-icon").each(function(b,f){if(c.refresh_identifier==d){var g=f.style.transform.split(/\w+\(|\);?/);if(3==g.length)var h=g[1].split("px").join("").split(" ").join("").split(",");3==h.length&&(h[0]<0||h[0]>e.width()||h[1]<0||h[1]>e.height()?a(f).addClass("out-of-bounds"):a(f).removeClass("out-of-bounds"))}}),a("#"+b+"-map .leaflet-marker-icon").addClass("flag-visible"),a("#"+b+"-legend .trigger").each(function(e,f){if(c.refresh_identifier==d){var g=a(f).attr("data-trigger-key");if("undefined"!=typeof g&&""!==g){var h=a(f).prop("checked");h||a("#"+b+"-map .leaflet-marker-icon."+g).removeClass("flag-visible")}}}),a("#"+b+"-map .leaflet-marker-icon:not(.flag-visible)").addClass("invisible"),a("#"+b+"-map .leaflet-marker-icon.flag-visible").removeClass("invisible");var f=a("#"+b+"-count-invisibles").prop("checked"),g={};a("#"+b+"-legend .trigger").each(function(e,h){if(c.refresh_identifier==d){var i=a(h).attr("data-trigger-key"),j=a(h).attr("data-filterid");if("undefined"!=typeof i&&""!==i){var k=a(h).prop("checked"),l=0,m=a("#"+b+"-map .leaflet-marker-icon."+i+":not(.out-of-bounds)");f?l=m.length:k&&(l=m.not(".invisible").length),a("#"+b+"-legend td."+i).html(l),"undefined"!=typeof j&&""!=j&&("undefined"==typeof g[j]&&(g[j]=0),g[j]+=l)}}}),Object.keys(g).forEach(function(c){a("#"+b+"-legend table."+c+" td.sum").html(g[c])})},orgcoursebasement:function(b){this.debug>0&&console.log("ADMIN.orgcoursebasement(basement)",b),require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"orgcoursebasement",basement:b},{signalItem:a("#block_eduvidual_admin_orgcoursebasement")})})},phpListConfig:function(b,c){this.debug>0&&console.log("ADMIN.phpListConfig(field, el)",b,c),require(["block_eduvidual/main"],function(d){d.watchValue({target:"#block_eduvidual_admin_phplist_"+b,run:function(){var d=this;require(["block_eduvidual/main"],function(e){e.connect({module:"admin",act:"phplistconfig",field:b,content:a(c).val()},{signalItem:a(d.target)})})}})})},protectedorgs:function(){this.debug>0&&console.log("ADMIN.protectedorgs()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_protectedorgs",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"protectedorgs",protectedorgs:a(b.target).val()},{signalItem:a(b.target)})})}})})},questioncategories:function(b){this.debug>0&&console.log("ADMIN.questioncategories()");var c=new Array;a.each(a("input[name='questioncategories[]']:checked"),function(){c.push(a(this).val())}),require(["block_eduvidual/main"],function(d){d.connect({module:"admin",act:"questioncategories",questioncategories:c},{signalItem:a(b).parent()})})},registrationcc:function(){this.debug>0&&console.log("ADMIN.registrationcc()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_registrationcc",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"registrationcc",registrationcc:a(b.target).val()},{signalItem:a(b.target)})})}})})},registrationsupport:function(){this.debug>0&&console.log("ADMIN.registrationsupport()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_registrationsupport",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"registrationsupport",registrationsupport:a(b.target).val()},{signalItem:a(b.target)})})}})})},requireCapability:function(b){this.debug>0&&console.log("ADMIN.requireCapability(val)",b),require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"requirecapability",requirecapability:b},{signalItem:a("#block_eduvidual_admin_requirecapability")})})},result:function(b){if("blockfooter"==b.data.act&&a("#block_eduvidual_footer").html(b.data.blockfooter),"coursebasements"==b.data.act&&history.go(0),"manageorgs_search"==b.data.act&&"undefined"!=typeof b.result.status&&"ok"==b.result.status){var c=a("#"+b.payload.uniqid+"-list").empty();if(this.cache_orgs=b.result.orgs,0===b.result.orgs.length)c.append(a("<li>").html("No results"));else for(var d=Object.keys(b.result.orgs),f=0;f<d.length;f++){var g=b.result.orgs[d[f]];c.append(a("<li>").append(a("<a>").append([a("<h3>").html(g.name),a("<p>").html(g.orgid)]).attr("href","#").attr("onclick","require(['block_eduvidual/admin'], function(ADMIN) { ADMIN.manageorgs_open('"+b.payload.uniqid+"', "+g.id+"); });")))}}if("manageorgs_store"==b.data.act&&"undefined"!=typeof b.result.errors&&b.result.errors.length>0)for(var f=0;f<b.result.errors.length;f++){var h=b.result.errors[f];a("#"+b.payload.uniqid+"-field-"+h).addClass("block_eduvidual_signal_error")}"modulecatstore"==b.data.act&&require(["block_eduvidual/main"],function(c){c.confirmed("#block_eduvidual_admin_modulecat_form","ok"==b.result.status);var d=b.result.category;if(console.log("There is a category",d),"ok"==b.result.status&&"undefined"!=typeof d.id&&d.id>0){if(b.data.categoryid==-1)return void c.navigate(e.fileUrl("/blocks/eduvidual/pages/admin.php?act=modulecats&categoryid="+d.id,""));console.log("Category just updated"),a('li[data-categoryid="'+d.id+'"]>a:first-child').html(d.name).removeClass("inactive").removeClass("active").addClass(1==d.active?"active":"inactive"),a("#block_eduvidual_admin_modulecat_form").attr("data-categoryid",d.id).attr("data-parentid",d.parentid).css("display","block"),a('#block_eduvidual_admin_modulecat_form input[name="categoryid"]').val(d.id),a("#block_eduvidual_admin_modulecat_form_active").val(d.active),a("#block_eduvidual_admin_modulecat_form_name").val(d.name),a("#block_eduvidual_admin_modulecat_form_description").val(d.description),a("#block_eduvidual_admin_modulecat_form_imageurl").val(d.imageurl)}a("#block_eduvidual_admin_modulecat_form_active").trigger("create")})},statsSwitchColumn:function(b,c){console.log("ADMIN.statsSwitchColumn(uniqid, sender)",b,c);var d=a(c).attr("data-type"),e=a("."+b+"-"+d),f=a(c).prop("checked")?"block":"none";e.css("display",f)},trashcategory:function(){this.debug>0&&console.log("ADMIN.trashcategory()"),require(["block_eduvidual/main"],function(b){b.watchValue({target:"#block_eduvidual_admin_trashcategory",run:function(){var b=this;require(["block_eduvidual/main"],function(c){c.connect({module:"admin",act:"trashcategory",trashcategory:a(b.target).val()},{signalItem:a(b.target)})})}})})}}});