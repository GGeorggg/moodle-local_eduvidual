define(["jquery","core/ajax","core/notification","core/str","core/url","local_eduvidual/main"],function(e,a,o,i,t,r){return{debug:1,debug_gps:1,cache_orgs:{},refresh_identifier:0,varcache:void 0,blockfooter:function(a){this.debug>0&&console.log("ADMIN.blockfooter()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_blockfooter",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"blockfooter",blockfooter:e(a.target).val()},{signalItem:e(a.target)})})}})})},coursebasements:function(a){this.debug>0&&console.log("ADMIN.coursebasements()");var o={module:"admin",act:"coursebasements",courseempty:e("#local_eduvidual_admin_coursebasements_courseempty").val(),courserestore:e("#local_eduvidual_admin_coursebasements_courserestore").val(),coursetemplate:e("#local_eduvidual_admin_coursebasements_coursetemplate").val()};require(["local_eduvidual/main"],function(i){i.connect(o,{signalItem:e(a)})})},coursedeleteform:function(a,o){var i=Math.round(e("#"+o+" select[name=size]").val()),t=Math.round(e("#"+o+" input[name=from]").val()),r="next"==a?t+i:t-i;r<0&&(r=0),e("#"+o+" input[name=from]").val(r),e("#"+o+" form").submit()},defaultrole:function(a,o){this.debug>0&&console.log("ADMIN.defaultrole(type, role)",a,o),require(["local_eduvidual/main"],function(i){i.connect({module:"admin",act:"defaultrole",type:a,role:o},{signalItem:e("#local_eduvidual_admin_defaultrole"+a)})})},dropZonePath:function(){this.debug>0&&console.log("ADMIN.dropZonePath()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_dropzonepath",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"dropzonepath",dropzonepath:e(a.target).val()},{signalItem:e(a.target)})})}})})},ltiresourcekey:function(){this.debug>0&&console.log("ADMIN.ltiresourcekey()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_ltiresourcekey",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"ltiresourcekey",ltiresourcekey:e(a.target).val()},{signalItem:e(a.target)})})}})})},manageorgs_open:function(a,o){var i=e("#"+a+"-form");e(i).find(".local_eduvidual_signal_error").removeClass("local_eduvidual_signal_error");var t=this.cache_orgs[o];if(void 0!==t){for(var r=Object.keys(t),l=0;l<r.length;l++){var n=r[l];e("#"+a+"-field-"+n).attr("data-orig",t[n]).val(t[n])}e("#"+a+"-field-manage").attr("data-orig",t.orgid)}else i.find("input").val("").attr("data-orig","");void 0!==t&&void 0!==t.categoryid&&t.categoryid>0?(e("#"+a+"-field-orgid").attr("readonly","readonly"),e("#"+a+"-field-categoryid").css("display","block"),e("#"+a+"-field-manage").css("display","block")):(e("#"+a+"-field-orgid").removeAttr("readonly"),e("#"+a+"-field-categoryid").css("display","none"),e("#"+a+"-field-manage").css("display","none"))},manageorgs_reset:function(e){this.manageorgs_open(e,0)},manageorgs_search:function(a){require(["local_eduvidual/main"],function(o){o.watchValue({target:"#"+a+"-search",run:function(){var o=this;require(["local_eduvidual/main"],function(i){i.connect({module:"admin",act:"manageorgs_search",search:e(o.target).val()},{signalItem:e(o.target),uniqid:a})})}})})},manageorgs_store:function(a){var o=e("#"+a+"-form");e(o).find(".local_eduvidual_signal_error").removeClass("local_eduvidual_signal_error");var i={};o.find("input").each(function(){if(void 0!==e(this).attr("id")&&""!=e(this).attr("id")){var o=e(this).attr("id").replace(a+"-field-","");i[o]=e(this).val()}}),require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"manageorgs_store",fields:i},{signalItem:e("#"+a+"-store"),uniqid:a})})},navbar:function(){this.debug>0&&console.log("ADMIN.navbar()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_navbar",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"navbar",navbar:e(a.target).val()},{signalItem:e(a.target)})})}})})},orgrole:function(a,o){this.debug>0&&console.log("ADMIN.orgrole(type, role)",a,o),require(["local_eduvidual/main"],function(i){i.connect({module:"admin",act:"orgrole",type:a,role:o},{signalItem:e("#local_eduvidual_admin_orgrole"+a)})})},globalrole:function(a,o){this.debug>0&&console.log("ADMIN.globalrole(type, role)",a,o),require(["local_eduvidual/main"],function(i){i.connect({module:"admin",act:"globalrole",type:a,role:o},{signalItem:e("#local_eduvidual_admin_globalrole"+a)})})},modifylogin:function(a){this.debug>0&&console.log("ADMIN.modifylogin(setto)",a),require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"modifylogin",setto:a},{signalItem:e("#local_eduvidual_admin_modifylogin")})})},moduleCatForm:function(e){require(["local_eduvidual/main"],function(a){a.connect({module:"admin",act:"modulecatform",categoryid:e})})},moolevels:function(a){this.debug>0&&console.log("ADMIN.moolevels()");var o=new Array;e.each(e("input[name='moolevels[]']:checked"),function(){o.push(e(this).val())}),require(["local_eduvidual/main"],function(i){i.connect({module:"admin",act:"moolevels",moolevels:o},{signalItem:e(a).parent()})})},org_gps:function(i,t,r,l,n){var u=this;u.refresh_identifier++;var d=u.refresh_identifier;void 0===i&&(i=e(".local_eduvidual_admin_map").attr("id")),void 0===t&&(t=-200),void 0===r&&(r=200),void 0===l&&(l=-200),void 0===n&&(n=200),console.log("ADMIN.org_gps(uniqid, lon1, lon2, lat1, lat2)",i,t,r,l,n);var c=e("#"+i+"-include-nonegroup").prop("checked")?1:0,s="local_eduvidual_admin_org_gps",g={lon1:t,lon2:r,lat1:l,lat2:n,includenonegroup:c,advanceddata:0};void 0!==u.map&&u.map.remove(),u.debug_gps&&console.log("Sending to "+s,g),a.call([{methodname:s,args:g,done:function(e){if(u.refresh_identifier==d){try{e=JSON.parse(e)}catch(e){}u.debug_gps&&console.log("Got response",e),u.orgs=e,u.org_gps_list(i)}},fail:o.exception}])},org_gps_bounds:function(a){var o=this;if(void 0!==o.map){var i=o.map.getBounds().toBBoxString().split(",");if(o.debug_gps&&console.log("Setting bounds to",i),e("#"+a).attr("data-lon1",i[0]),e("#"+a).attr("data-lon2",i[2]),e("#"+a).attr("data-lat1",i[1]),e("#"+a).attr("data-lat2",i[3]),void 0===o.map_moved)o.map_moved=0;else{o.map_moved++;var t=o.map_moved;setTimeout(function(){t==o.map_moved&&o.org_gps_refresh(a)},1e3)}}},org_gps_list:function(a){var o=this;o.debug_gps&&console.log("ADMIN.org_gps_list(uniqid)",a),void 0!==o.map&&o.map.remove();var i=o.refresh_identifier,r=e("#"+a+"-include-nonegroup").prop("checked")?1:0;e("#"+a+"-legend td.none").parent().css("display",r?"table-row":"none"),e("#"+a+"-legend-none").css("display",r?"inline-block":"none");var l=o.orgs,n=new Date(e("#"+a+"-year").val(),e("#"+a+"-month").val()-1,e("#"+a+"-day").val(),e("#"+a+"-hour").val(),e("#"+a+"-minute").val(),e("#"+a+"-second").val(),0);e("#"+a+"-second").val(n.getSeconds()),e("#"+a+"-minute").val(n.getMinutes()),e("#"+a+"-hour").val(n.getHours()),e("#"+a+"-day").val(n.getDate()),e("#"+a+"-month").val(n.getMonth()+1),e("#"+a+"-year").val(n.getFullYear());var u=Math.floor(n.getTime()/1e3),d=200,c=200,s=-200,g=-200,m={both:0,eduv:0,none:0},v=[L.layerGroup(),L.layerGroup(),L.layerGroup(),L.layerGroup()],p={0:"",1:"Burgenland",2:"Kärnten",3:"Niederösterreich",4:"Oberösterreich",5:"Salzburg",6:"Steiermark",7:"Tirol",8:"Vorarlberg",9:"Wien"},f={0:"Sonstige",1:"VS",2:"MS",3:"Sonderschule",4:"PTS",5:"BS",6:"Gymnasium",7:"HTL",8:"HAK",9:"HUM"};Object.keys(l).forEach(function(e){if(console.log("refresh_identifier",o.refresh_identifier,i),o.refresh_identifier==i){l[e].url=t.relativeUrl("/local/eduvidual/pages/myorgs.php?orgid="+l[e].orgid);var a=l[e].orgid.toString().split("").pop(),n=l[e].orgid.toString().split("")[0];l[e].classes=f[a]+" "+p[n];var v="red";l[e].ignore=!1,l[e].authenticated>0&&l[e].authenticated<u&&null!=l[e].lpf?(v="orange",m.both++,l[e].classes+=" both",l[e].layer=2,l[e].url=t.relativeUrl("/local/eduvidual/pages/myorgs.php?orgid="+l[e].orgid)):l[e].authenticated>0&&l[e].authenticated<u?(v="green",m.eduv++,l[e].classes+=" eduv",l[e].layer=3,l[e].url=t.relativeUrl("/local/eduvidual/pages/myorgs.php?orgid="+l[e].orgid)):1==r?(v="lightgray",m.none++,l[e].classes+=" none invisible",l[e].layer=0,l[e].url=""):l[e].ignore=!0,"lightgray"!=v&&a>0&&(l[e].lon<c&&(c=l[e].lon),l[e].lon>g&&(g=l[e].lon),l[e].lat<d&&(d=l[e].lat),l[e].lat>s&&(s=l[e].lat)),l[e].marker=t.relativeUrl("/local/eduvidual/pix/google-maps-pin-"+v+".svg#"+l[e].classes+"#"+l[e].layer)}}),d=45.18189988240382,c=8.88805461218309,s=49.517950306694665,g=17.45739054968309;var _=[[d,c],[s,g]],h=(d+s)/2,b=(c+g)/2,y=[h,b];o.debug_gps&&console.log("Bounds",_),o.debug_gps&&console.log("Center",y);var q=e("#"+a+"-map").width();o.debug_gps&&console.log("Width",q),o.debug_gps&&console.log("Height",q/4*3),e("#"+a+"-map").css("height",q/4*3+"px");var k=L.icon({iconUrl:t.relativeUrl("/local/eduvidual/pix/google-maps-pin-blue.svg"),iconRetinaUrl:t.relativeUrl("/local/eduvidual/pix/google-maps-pin-blue.svg"),iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]});Object.keys(l).forEach(function(e){if(o.refresh_identifier==i&&!l[e].ignore){var a=k;void 0!==l[e].marker&&""!=l[e].marker&&(a=L.icon({iconUrl:l[e].marker,iconRetinaUrl:l[e].marker,iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]}));L.marker([l[e].lat,l[e].lon],{icon:a}).bindPopup(void 0!==l[e].url&&""!=l[e].url?'<a href="'+l[e].url+'" target="_blank">'+l[e].name+" ("+e+")</a>":l[e].name).addTo(v[l[e].layer])}});var I=[n.getFullYear(),String(n.getMonth()+1).padStart(2,"0"),String(n.getDate()).padStart(2,"0")].join("-"),M="Visualisierung der Moodle-Schulen in Österreich | "+I+' | <a href="https://www.lernmanagement.at" target="_blank">Zentrum für Lernmanagement</a> | powered by &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>';o.map=L.map(a+"-map",{boxZoom:!0,center:y,layers:v,zoom:14,zoomControl:!1,zoomSnap:.5}),o.map.fitBounds(_,{maxZoom:18}),o.map.on("moveend",function(e){o.org_gps_bounds(a)}),o.map.on("resize",function(i){o.debug_gps&&console.log("Map was resized",i);var t=e("#"+a+"-map").width();o.debug_gps&&console.log("Width",t),o.debug_gps&&console.log("Height",t*(1/9*6)),e("#"+a+"-map").css("height",t*(1/9*6)+"px")}),{normal:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:M,id:"mapbox.normal",subdomains:["a","b","c"]})}.normal.addTo(o.map),L.control.zoom({position:"bottomright"}).addTo(o.map),e("#"+a+" .leaflet-marker-pane img").each(function(a,t){if(o.refresh_identifier==i){var r=e(t).attr("src"),l=r.split("#");3==l.length&&(e(t).addClass(l[1].replace(","," ")),e(t).css("z-index",990+l[2]))}}),e("#"+a+"-map").css("height",e("#"+a+"-map").width()*(1/9*6)+"px"),o.org_gps_bounds(a),o.org_gps_refresh(a)},org_gps_refresh:function(a){var o=this;o.refresh_identifier++;var i=o.refresh_identifier;console.log("ADMIN.org_gps_refresh(uniqid)",a);var t=e("#"+a+"-map");e("#"+a+"-map .leaflet-marker-icon").each(function(a,r){if(o.refresh_identifier==i){var l=r.style.transform.split(/\w+\(|\);?/);if(3==l.length)var n=l[1].split("px").join("").split(" ").join("").split(",");3==n.length&&(n[0]<0||n[0]>t.width()||n[1]<0||n[1]>t.height()?e(r).addClass("out-of-bounds"):e(r).removeClass("out-of-bounds"))}}),e("#"+a+"-map .leaflet-marker-icon").addClass("flag-visible"),e("#"+a+"-legend .trigger").each(function(t,r){if(o.refresh_identifier==i){var l=e(r).attr("data-trigger-key");if(void 0!==l&&""!==l){e(r).prop("checked")||e("#"+a+"-map .leaflet-marker-icon."+l).removeClass("flag-visible")}}}),e("#"+a+"-map .leaflet-marker-icon:not(.flag-visible)").addClass("invisible"),e("#"+a+"-map .leaflet-marker-icon.flag-visible").removeClass("invisible");var r=e("#"+a+"-count-invisibles").prop("checked"),l={};e("#"+a+"-legend .trigger").each(function(t,n){if(o.refresh_identifier==i){var u=e(n).attr("data-trigger-key"),d=e(n).attr("data-filterid");if(void 0!==u&&""!==u){var c=e(n).prop("checked"),s=0,g=e("#"+a+"-map .leaflet-marker-icon."+u+":not(.out-of-bounds)");r?s=g.length:c&&(s=g.not(".invisible").length),e("#"+a+"-legend td."+u).html(s),void 0!==d&&""!=d&&(void 0===l[d]&&(l[d]=0),l[d]+=s)}}}),Object.keys(l).forEach(function(o){e("#"+a+"-legend table."+o+" td.sum").html(l[o])})},orgcoursebasement:function(a){this.debug>0&&console.log("ADMIN.orgcoursebasement(basement)",a),require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"orgcoursebasement",basement:a},{signalItem:e("#local_eduvidual_admin_orgcoursebasement")})})},phpListConfig:function(a,o){this.debug>0&&console.log("ADMIN.phpListConfig(field, el)",a,o),require(["local_eduvidual/main"],function(i){i.watchValue({target:"#local_eduvidual_admin_phplist_"+a,run:function(){var i=this;require(["local_eduvidual/main"],function(t){t.connect({module:"admin",act:"phplistconfig",field:a,content:e(o).val()},{signalItem:e(i.target)})})}})})},protectedorgs:function(){this.debug>0&&console.log("ADMIN.protectedorgs()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_protectedorgs",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"protectedorgs",protectedorgs:e(a.target).val()},{signalItem:e(a.target)})})}})})},questioncategories:function(a,o){this.debug>0&&console.log("ADMIN.questioncategories(uniqid, catid)",a,o);var i=e(".questioncategory-"+a+"-"+o),t=new Array,r=new Array;e.each(e(".questioncategories-"+a+":checked"),function(){var o=e(this).val();t.push(o),r.push(e(".supportcourses-"+a+"-"+o).val())}),require(["local_eduvidual/main"],function(a){a.connect({module:"admin",act:"questioncategories",questioncategories:t,supportcourses:r},{signalItem:e(i)})})},registrationcc:function(){this.debug>0&&console.log("ADMIN.registrationcc()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_registrationcc",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"registrationcc",registrationcc:e(a.target).val()},{signalItem:e(a.target)})})}})})},registrationsupport:function(){this.debug>0&&console.log("ADMIN.registrationsupport()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_registrationsupport",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"registrationsupport",registrationsupport:e(a.target).val()},{signalItem:e(a.target)})})}})})},requireCapability:function(a){this.debug>0&&console.log("ADMIN.requireCapability(val)",a),require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"requirecapability",requirecapability:a},{signalItem:e("#local_eduvidual_admin_requirecapability")})})},result:function(a){if("blockfooter"==a.data.act&&e("#local_eduvidual_footer").html(a.data.blockfooter),"coursebasements"==a.data.act&&history.go(0),"manageorgs_search"==a.data.act&&void 0!==a.result.status&&"ok"==a.result.status){var o=e("#"+a.payload.uniqid+"-list").empty();if(this.cache_orgs=a.result.orgs,0===a.result.orgs.length)o.append(e("<li>").html("No results"));else for(var i=Object.keys(a.result.orgs),r=0;r<i.length;r++){var l=a.result.orgs[i[r]];o.append(e("<li>").append(e("<a>").html(l.name+" ("+l.orgid+")").attr("href","#").attr("onclick","require(['local_eduvidual/admin'], function(ADMIN) { ADMIN.manageorgs_open('"+a.payload.uniqid+"', "+l.id+"); });")))}}if("manageorgs_store"==a.data.act&&void 0!==a.result.errors&&a.result.errors.length>0)for(var r=0;r<a.result.errors.length;r++){var n=a.result.errors[r];e("#"+a.payload.uniqid+"-field-"+n).addClass("local_eduvidual_signal_error")}"modulecatstore"==a.data.act&&require(["local_eduvidual/main"],function(o){o.confirmed("#local_eduvidual_admin_modulecat_form","ok"==a.result.status);var i=a.result.category;if(console.log("There is a category",i),"ok"==a.result.status&&void 0!==i.id&&i.id>0){if(-1==a.data.categoryid)return void o.navigate(t.fileUrl("/local/eduvidual/pages/admin.php?act=modulecats&categoryid="+i.id,""));console.log("Category just updated"),e('li[data-categoryid="'+i.id+'"]>a:first-child').html(i.name).removeClass("inactive").removeClass("active").addClass(1==i.active?"active":"inactive"),e("#local_eduvidual_admin_modulecat_form").attr("data-categoryid",i.id).attr("data-parentid",i.parentid).css("display","block"),e('#local_eduvidual_admin_modulecat_form input[name="categoryid"]').val(i.id),e("#local_eduvidual_admin_modulecat_form_active").val(i.active),e("#local_eduvidual_admin_modulecat_form_name").val(i.name),e("#local_eduvidual_admin_modulecat_form_description").val(i.description),e("#local_eduvidual_admin_modulecat_form_imageurl").val(i.imageurl)}e("#local_eduvidual_admin_modulecat_form_active").trigger("create")})},statsSwitchColumn:function(a,o){console.log("ADMIN.statsSwitchColumn(uniqid, sender)",a,o);var i=e(o).attr("data-type"),t=e("."+a+"-"+i),r=e(o).prop("checked")?"block":"none";t.css("display",r)},supportcourseurl:function(){this.debug>0&&console.log("ADMIN.supportcourseurl()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_supportcourseurl",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"supportcourseurl",supportcourseurl:e(a.target).val()},{signalItem:e(a.target)})})}})})},trashcategory:function(){this.debug>0&&console.log("ADMIN.trashcategory()"),require(["local_eduvidual/main"],function(a){a.watchValue({target:"#local_eduvidual_admin_trashcategory",run:function(){var a=this;require(["local_eduvidual/main"],function(o){o.connect({module:"admin",act:"trashcategory",trashcategory:e(a.target).val()},{signalItem:e(a.target)})})}})})}}});